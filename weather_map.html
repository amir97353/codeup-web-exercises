<!doctype html>
<html lang="en">
<head>

    <title>Document</title>
<!--    //Below is the Jquery link-->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"
            integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
<!--    //The two link below are mapbox api-->
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.10.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.10.0/mapbox-gl.css' rel='stylesheet'/>
<!--    //The two links below are bootstrap-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
            crossorigin="anonymous"></script>


    <style>
        #map {

            width: 100%;
            height: 350px;
        }

        .card-body {
            border-width: 5px;
            border-style: solid;
        }

        * {

        }
    </style>


</head>
<body>


<div id="cards" class="d-flex">

</div>
<input id="search" placeholder="Where you at?">
<button id="button">Search</button>
<div id='map'></div>
<script src="js/keys.js"></script>
<script src="js/mapbox-geocoder.js"></script>

</body>
</html>




<style>
    #map {

        width: 100%;
        height: 400px;
        margin: 0;
    }

    .card-body {
        border-width: 5px;
        border-style: solid;
        width: 100%;
        border-radius: 10px;
    }

    * {
        margin: 10px;
        padding: 0;
    }

    .card-text{
        /*width: 40px;*/
    }
    .card-title {
        background-color: lightgray;
        width: 100%;
        display: flex;
        border-width: thin;
        margin: 0;
        text-align: center;
        border-radius: 1px;
        height: 50px;

    }
</style>

<script>




    function updateCards (lon,lat) {


        let html = ''

        $.get("https://api.openweathermap.org/data/2.5/forecast?lat=" + lat + "&lon=" + lon + "&appid=" + open_weather_api, {
            // APPID: open_weather_api,
            // q: "Houston, US",
            units: "imperial"
        }).done(function (data) {


            for (let i = 0; i <= 39; i += 8) {
                // html += ""
                console.log(data.list[i])

                data.list[i].weather[0].description

                data.list[i].main.humidity

                data.list[i].wind.speed

                data.list[i].main.pressure

                data.list[i].dt_txt

                console.log(data.list[i])


                html += "<div className = 'card' class='d-flex justify-content-center cards' style = 'max-width: 100%;' >"

                html += "<div class='card-body'>"
                html += "<h5 class='card-title'>" + "Weather Forecast" + "</h5>"
                html += "<p class='card-text'> <img src='http://openweathermap.org/img/w/" + data.list[i].weather[0].icon + ".png' </p>"
                html += "<p className='card-text'>" + "Description:  " + data.list[i].weather[0].description + "</p>"
                html += "<div class = 'card-header'>" + "Date: " + data.list[i].dt_txt + "</div>"
                html += "<p className='card-text'>" + "Humidity:  " + data.list[i].main.humidity + "</p>"
                html += "<p className='card-text'>" + "Wind:  " + data.list[i].wind.speed + "</p>"
                html += "<p className='card-text'>" + "Pressure:  " + data.list[i].main.pressure + "</p>"
                html += "</div>"
                html += "</div>"


            }
            $('#cards').html(html)

        });
    }

    mapboxgl.accessToken = MAPBOX_TOKEN;
    let map = new mapboxgl.Map({
        container: 'map', // container ID
        style: 'mapbox://styles/mapbox/streets-v11', // style URL
        zoom: 10, // starting zoom
        center: [-95.358421, 29.749907] // [lng, lat]
    });
    updateCards(-95.358421, 29.749907);


    document.getElementById("button").addEventListener("click", function () {
        let currentLocation = geocode(document.getElementById("search").value, MAPBOX_TOKEN);
        currentLocation.then(function (results) {
            map.setCenter([results[0], results[1]])
            // console.log(results[0])
            let result2 =results[1]
            let result1 =results[0]
            updateCards(result1,result2)

        })

    })


    let clickMarker = new mapboxgl.Marker()
    map.on('click', function(e) {
        let lngLat = e.lngLat;
        // console.log(lngLat.lng)
        // console.log(lngLat.lat)
            let lat = lngLat.lat;
            let long = lngLat.lng;
        clickMarker.setLngLat([long,lat]).addTo(map);
        updateCards(long,lat)
    })
    clickMarker.remove();


    //     let clickMarker = new mapboxgl.Marker()
// let map_variable =document.querySelector("#map")
//     map_variable.addEventListener("click", () => {
//         navigator.geolocation.getCurrentPosition((position) => {
//             let lat = position.coords.latitude;
//             let long = position.coords.longitude;
//             console.log(lat)
//             console.log(long)
//
//             clickMarker.setLngLat([long,lat]).addTo(map);
//
//
//         });
//
//     });




</script>
